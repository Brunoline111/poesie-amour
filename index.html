<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">

  <title>Poésie Amour - Accueil</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff0f6;
      margin: 0;
      padding: 0;
      color: #333;
    }

    nav {
      background: #d63384;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    nav h1 {
      margin: 0;
      font-weight: 700;
      font-size: 1.5rem;
    }

    nav a.create-poem-btn {
      color: white;
      font-weight: 600;
      text-decoration: none;
      margin-right: 20px;
      padding: 8px 12px;
      border: 2px solid white;
      border-radius: 8px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    nav a.create-poem-btn:hover {
      background: white;
      color: #d63384;
    }

    #profileBtn {
      background: transparent;
      border: none;
      cursor: pointer;
      color: white;
      font-weight: 600;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }

    #profileBtn img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }

    #profileMenu {
      position: absolute;
      top: 60px;
      right: 20px;
      background: white;
      color: #333;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(214, 51, 132, 0.4);
      width: 260px;
      display: none;
      flex-direction: column;
      padding: 10px 0;
      z-index: 1000;
      overflow: hidden;
    }

    #profileMenu.active {
      display: flex;
    }

    #profileMenu button,
    #profileMenu .menu-item {
      padding: 12px 20px;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s ease;
      box-sizing: border-box;
    }

    #profileMenu .menu-item {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    #profileMenu button:hover,
    #profileMenu .menu-item:hover {
      background: #f8bbd0;
    }

    #poemsSection {
      max-width: 900px;
      margin: 30px auto 60px;
      padding: 0 20px;
    }

    #poemsSection h2 {
      color: #d63384;
      text-align: center;
      margin-bottom: 25px;
      font-weight: 700;
    }

  @media (max-width: 768px) {
  header {
    font-size: 1.2rem;
    padding: 12px 16px;
  }

  .header-buttons {
    position: static;
    transform: none;
    text-align: center;
    margin-top: 10px;
  }

  .header-buttons button {
    margin: 6px 5px;
    padding: 8px 16px;
    font-size: 0.9rem;
  }

  main {
    padding: 15px;
    margin: 10px;
  }

  .new-fields input,
  .sub-controls input,
  .sub-controls select {
    font-size: 1rem;
    padding: 8px;
  }

  .sub-controls {
    flex-direction: column;
    align-items: flex-start;
  }

  .toolbar {
    flex-direction: column;
    gap: 8px;
  }

  .fond-selection {
    gap: 8px;
  }

  .fond-selection img {
    width: 80px;
    height: 55px;
  }

  .cadres {
    flex-wrap: wrap;
    justify-content: center;
  }

  .cadre {
    width: 50px;
    height: 50px;
  }

  .preview {
    max-width: 100%;
    padding: 20px;
    font-size: 1rem;
  }

  #publier {
    width: 100%;
    padding: 12px 0;
    font-size: 1rem;
  }

  .preview-title {
    font-size: 1.1rem;
    padding: 10px 0;
  }

  .config-title,
  .config-author {
    padding: 8px;
    font-size: 0.95rem;
  }

  select,
  input[type="color"],
  input[type="number"] {
    width: 100%;
  }
}

  @media (max-width: 480px) {
  body {
    font-size: 14px;
  }

  .header-buttons {
    flex-direction: column;
    align-items: center;
    margin-top: 10px;
  }

  .toolbar {
    gap: 6px;
  }

  .toolbar button,
  .toolbar select,
  .toolbar input {
    width: 100%;
    font-size: 0.9rem;
  }

  .new-fields input {
    font-size: 0.95rem;
  }

  .preview {
    padding: 15px;
  }

  .preview-title {
    font-size: 1rem;
  }

  .cadres {
    gap: 10px;
  }

  .cadre {
    width: 45px;
    height: 45px;
  }
}



    /* Ajoutez ici les styles des poèmes */
  </style>
</head>
<body>

  <nav>
    <h1>Poésie Amour</h1>
    <a href="create.html" class="create-poem-btn">Créer un poème</a>

    <button id="profileBtn" aria-haspopup="true" aria-expanded="false" title="Profil utilisateur">
      <img src="https://via.placeholder.com/32" alt="Avatar utilisateur" id="profileAvatar" />
      <span id="profileName">Utilisateur</span>
    </button>

    <div id="profileMenu" role="menu" aria-label="Menu profil utilisateur">
      <a href="profile.html" class="menu-item">Mon profil</a>
      <button id="logoutBtn">Se déconnecter</button>
    </div>
  </nav>

  <main>
    <section id="poemsSection" aria-live="polite" aria-atomic="true">
      <h2>Poèmes récents</h2>
      <div id="poemsContainer">
        <!-- Poèmes générés via JS ici -->
      </div>
    </section>
  </main>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCtm5hzBBhiYBXJ3FN4tmdkm44LK6tMbXs",
      authDomain: "poesie-amour.firebaseapp.com",
      projectId: "poesie-amour",
      storageBucket: "poesie-amour.appspot.com",
      messagingSenderId: "72054264195",
      appId: "1:72054264195:web:63eae95b68736a77a5e6b6",
      measurementId: "G-Y7PXEZ6VRW"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const profileBtn = document.getElementById('profileBtn');
    const profileMenu = document.getElementById('profileMenu');
    const logoutBtn = document.getElementById('logoutBtn');
    const profileAvatar = document.getElementById('profileAvatar');
    const profileNameSpan = document.getElementById('profileName');

    const defaultPhotos = [
      "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=200&q=80",
      "https://images.unsplash.com/photo-1500534623283-312aade485b7?auto=format&fit=crop&w=200&q=80",
      "https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=200&q=80",
      "https://images.unsplash.com/photo-1445820131753-5a1ecdb8e3ee?auto=format&fit=crop&w=200&q=80",
      "https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=200&q=80"
    ];

    profileBtn.addEventListener('click', () => {
      const isActive = profileMenu.classList.contains('active');
      profileMenu.classList.toggle('active', !isActive);
      profileBtn.setAttribute('aria-expanded', !isActive);
    });

    document.addEventListener('click', e => {
      if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.classList.remove('active');
        profileBtn.setAttribute('aria-expanded', false);
      }
    });

    logoutBtn.addEventListener('click', async () => {
      try {
        await auth.signOut();
        window.location.href = 'login.html';
      } catch (error) {
        alert('Erreur lors de la déconnexion : ' + error.message);
      }
    });

    auth.onAuthStateChanged(async user => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }

      const doc = await db.collection('users').doc(user.uid).get();
      const data = doc.exists ? doc.data() : {};
      const name = data.name || user.displayName || user.email || "Utilisateur";
      const photo = user.photoURL || data.photoURL || defaultPhotos[Math.floor(Math.random() * defaultPhotos.length)];

      profileNameSpan.textContent = name;
      profileAvatar.src = photo;
    });
  </script>

</body>
</html>
